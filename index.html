<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA Pro X - Center Edition</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --accent: #fbc02d;
            --p-color: #3b82f6;
            --b-color: #ef4444;
            --t-color: #22c55e;
            --text-main: #f8fafc;
            --border: #334155;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: var(--bg-color); color: var(--text-main); 
            margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center;
        }

        /* Navigation Tabs */
        .tabs { display: flex; width: 100%; max-width: 400px; gap: 8px; margin-bottom: 12px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: var(--card-bg); color: #94a3b8; cursor: pointer; border-radius: 12px; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: var(--accent); color: #000; box-shadow: 0 4px 10px rgba(251, 192, 45, 0.3); }

        .container { width: 100%; max-width: 400px; display: none; }
        .container.active { display: block; }

        .card { background: var(--card-bg); border-radius: 20px; padding: 15px; border: 1px solid var(--border); margin-bottom: 12px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); }

        /* Stats Header */
        .header-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .stat-mini { background: #0f172a; padding: 10px; border-radius: 15px; text-align: center; border: 1px solid var(--border); }
        .stat-mini small { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; }
        .stat-mini div { font-size: 1.2rem; font-weight: 800; }

        /* 3D Prediction Box */
        .prediction-zone { display: flex; align-items: center; gap: 15px; padding: 15px 0; min-height: 145px; }
        .left-predict { width: 40%; display: flex; justify-content: center; border-right: 1px solid var(--border); }
        .right-bet { width: 60%; text-align: center; }

        .target-box-3d {
            width: 90px; height: 90px; background: #1e293b; border-radius: 22px;
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 5px 5px 15px rgba(0,0,0,0.4);
            display: flex; align-items: center; justify-content: center;
            font-size: 50px; font-weight: 900; color: #334155;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: perspective(500px) rotateX(10deg);
        }
        .active-P-3d { background: linear-gradient(145deg, #3b82f6, #2563eb); color: #fff !important; transform: scale(1.05) rotateX(0); box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4); }
        .active-B-3d { background: linear-gradient(145deg, #ef4444, #dc2626); color: #fff !important; transform: scale(1.05) rotateX(0); box-shadow: 0 10px 20px rgba(239, 68, 68, 0.4); }

        .bet-label { font-size: 0.85rem; color: #94a3b8; }
        .bet-amount { font-size: 2.8rem; font-weight: 900; color: var(--accent); display: none; margin: 5px 0; }
        .bet-amount.show { display: block; animation: zoomIn 0.3s; }

        /* Road Map 6x12 Fixed */
        .grid-container {
            display: grid; grid-template-rows: repeat(6, 1fr); grid-template-columns: repeat(12, 1fr);
            grid-auto-flow: column; gap: 4px; background: #0f172a; padding: 10px;
            border-radius: 12px; aspect-ratio: 12 / 6; width: 100%; border: 1px solid #334155;
        }
        .dot { width: 100%; aspect-ratio: 1/1; border-radius: 50%; background: #1e293b; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; border: 1px solid #334155; }
        .dot.P { background: var(--p-color); color: white; border-color: #60a5fa; }
        .dot.B { background: var(--b-color); color: white; border-color: #f87171; }
        .dot.T { background: var(--t-color); color: white; border-color: #4ade80; }

        /* Input Buttons */
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 5px; }
        .btn { padding: 20px; border: none; border-radius: 16px; font-size: 1.8rem; font-weight: 900; color: white; cursor: pointer; transition: 0.1s; }
        .btn:active { transform: translateY(3px); }
        .btn-p { background: var(--p-color); }
        .btn-b { background: var(--b-color); }
        .btn-t { background: var(--t-color); font-size: 1.2rem; }

        /* --- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πà‡∏≤‡∏á ‡∏ß‡∏≤‡∏á‡∏ä‡∏¥‡∏î‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á --- */
        .bottom-controls {
            display: flex;
            justify-content: center; /* ‡∏ß‡∏≤‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            gap: 15px; /* ‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô 15px */
            width: 100%;
            margin-top: 15px;
        }
        .btn-mini {
            width: 80px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏á‡∏ó‡∏µ‡πà 80px */
            padding: 12px 0;
            border: none;
            border-radius: 12px;
            background: #334155;
            color: #f8fafc;
            font-size: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .btn-reset { color: #f87171; border-color: rgba(239, 68, 68, 0.2); }
        .btn-mini:active { transform: scale(0.92); opacity: 0.8; }

        /* Overlays & Modals */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(6px); }
        .overlay.active { display: flex; }
        .modal { background: var(--card-bg); width: 85%; max-width: 320px; padding: 25px; border-radius: 25px; text-align: center; border: 1px solid var(--border); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5); }
        .modal-btns { display: flex; gap: 10px; margin-top: 20px; }
        .modal-btns button { flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; }

        @keyframes zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        input { width: 100%; background: #0f172a; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 12px; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('scanner')">‡∏™‡πÅ‡∏Å‡∏ô DNA</button>
        <button class="tab-btn" onclick="switchTab('money')">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
    </div>

    <div id="scanner" class="container active">
        <div class="header-stats">
            <div class="stat-mini">
                <small>‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∞‡∏™‡∏°</small>
                <div id="top-bal" style="color:var(--t-color)">0</div>
            </div>
            <div class="stat-mini">
                <small>WIN COUNT</small>
                <div id="win-count" style="color:var(--accent)">0</div>
            </div>
        </div>

        <div class="card prediction-zone">
            <div class="left-predict">
                <div id="target" class="target-box-3d">?</div>
            </div>
            <div class="right-bet">
                <span class="bet-label" id="step-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</span>
                <div class="bet-amount" id="ui-bet">0</div>
                <div id="ui-mode" style="font-size:0.75rem; margin-top:10px; color:#64748b;">
                    ‡πÑ‡∏°‡πâ <span id="ui-pos">1</span> | S<span id="ui-step">1</span>
                </div>
            </div>
        </div>

        <div class="card" style="padding: 10px;">
            <div id="grid" class="grid-container"></div>
        </div>

        <div class="btn-grid">
            <button class="btn btn-p" onclick="handleInput('P')">P</button>
            <button class="btn btn-t" onclick="handleInput('T')">T</button>
            <button class="btn btn-b" onclick="handleInput('B')">B</button>
        </div>
        
        <div class="bottom-controls">
            <button class="btn-mini" onclick="undo()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button class="btn-mini btn-reset" onclick="showResetModal()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        </div>
    </div>

    <div id="money" class="container">
        <div class="card">
            <h4>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡πÑ‡∏£ (Target)</h4>
            <input type="number" id="profit-goal" value="" onchange="render()">
            <h4 style="margin-top:15px">‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ó‡∏ö)</h4>
            <input type="text" id="money-seq" value="10, 20, 40, 80, 160, 320" onchange="updateConfig()">
        </div>
    </div>

    <div id="reset-modal" class="overlay">
        <div class="modal">
            <h2 style="color:#f87171">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?</h2>
            <p>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ</p>
            <div class="modal-btns">
                <button style="background:#475569; color:white" onclick="closeModal('reset-modal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button style="background:var(--b-color); color:white" onclick="confirmReset()">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
        </div>
    </div>

    <div id="goal-modal" class="overlay">
        <div class="modal" style="border-color: var(--accent);">
            <div style="font-size:50px;">üèÜ</div>
            <h2 style="color:var(--accent)">‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!</h2>
            <p>‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏Å‡∏≥‡πÑ‡∏£‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö<br>‡∏Ñ‡∏ß‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ñ‡∏≠‡∏ô‡∏Å‡∏≥‡πÑ‡∏£‡∏Å‡πà‡∏≠‡∏ô</p>
            <button style="background:var(--t-color); color:white; width:100%; padding:12px; border:none; border-radius:12px; font-weight:bold;" onclick="closeModal('goal-modal')">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
        </div>
    </div>

<script>
    let log = []; 
    let historyStack = [];
    let moneySequence = [10, 20, 40, 80, 160, 320];
    let profiles = [];
    let state = { idx: 0, pos: 1, bal: 0, bet: 10, isClearing: false, wins: 0, isFound: false, aim: "", goalReached: false };

    for(let i=0; i<32; i++) profiles.push(i.toString(2).padStart(5,'0').split('').map(b => b === '0' ? 'M' : 'T'));

    function switchTab(id) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
    }

    function updateConfig() {
        moneySequence = document.getElementById('money-seq').value.split(',').map(v => parseFloat(v.trim()) || 0);
        calculateBet(); render();
    }

    function calculateBet() {
        let base = moneySequence[state.idx] || 0;
        state.bet = state.isClearing ? base * 2 : base;
    }

    function showResetModal() { document.getElementById('reset-modal').classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    
    function confirmReset() {
        log = []; historyStack = [];
        state = { idx: 0, pos: 1, bal: 0, bet: 10, isClearing: false, wins: 0, isFound: false, aim: "", goalReached: false };
        closeModal('reset-modal');
        render();
    }

    function handleInput(v) {
        historyStack.push(JSON.stringify({ log: [...log], state: {...state} }));
        if (v !== 'T' && state.isFound && state.aim !== "") {
            if (v === state.aim) {
                state.bal += state.bet; state.wins++;
                if (state.bal >= 0 && state.idx > 0) { state.idx = 0; state.pos = 1; state.isClearing = false; }
                else if (state.isClearing) { state.isClearing = false; state.pos = 1; }
                else { if (state.idx !== 0 && state.pos === 2) { state.idx = Math.max(0, state.idx - 1); state.isClearing = true; } state.pos = 1; }
            } else {
                state.bal -= state.bet;
                if (state.isClearing) { state.isClearing = false; state.idx = Math.min(moneySequence.length-1, state.idx+1); state.pos = 1; }
                else { if (state.pos === 1) state.pos = 2; else { state.idx = Math.min(moneySequence.length-1, state.idx+1); state.pos = 1; } }
            }
            state.isFound = false; state.aim = "";
        }
        log.push(v);
        if (log.length > 72) log.shift();
        
        const goal = parseFloat(document.getElementById('profit-goal').value) || 0;
        if (goal > 0 && state.bal >= goal && !state.goalReached) {
            document.getElementById('goal-modal').classList.add('active');
            state.goalReached = true;
        }
        render();
    }

    function undo() { if (historyStack.length > 0) { let last = JSON.parse(historyStack.pop()); log = last.log; state = last.state; render(); } }

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = "";
        for(let i=0; i<72; i++) {
            const d = document.createElement('div'); d.className = 'dot';
            if(log[i]) { d.className += ' ' + log[i]; d.innerText = log[i]; }
            grid.appendChild(d);
        }

        document.getElementById('top-bal').innerText = state.bal.toLocaleString();
        document.getElementById('top-bal').style.color = state.bal >= 0 ? 'var(--t-color)' : 'var(--b-color)';
        document.getElementById('win-count').innerText = state.wins.toLocaleString();
        
        const targetUI = document.getElementById('target'), betUI = document.getElementById('ui-bet'), stepInfo = document.getElementById('step-info');
        targetUI.className = "target-box-3d"; targetUI.innerText = "?";
        betUI.classList.remove('show');

        const clean = log.filter(x => x !== 'T');
        if (clean.length >= 6 && !state.isFound) {
            for (let d = 0; d < 32; d++) {
                let streak = 0;
                for (let r = 1; r < clean.length; r++) {
                    let prev = clean[r-1], actual = clean[r], bit = profiles[d][r % 5];
                    let predict = (bit === 'M') ? prev : (prev === 'P' ? 'B' : 'P');
                    if (predict !== actual) streak++; else streak = 0;
                }
                if (streak === 5) { state.isFound = true; state.activeDNA = d; break; }
            }
        }

        if (state.isFound) {
            let lastPrev = clean[clean.length-1];
            let bit = profiles[state.activeDNA][clean.length % 5];
            state.aim = (bit === 'M') ? lastPrev : (lastPrev === 'P' ? 'B' : 'P');
            targetUI.innerText = state.aim; 
            targetUI.classList.add(`active-${state.aim}-3d`);
            
            calculateBet();
            betUI.innerText = state.bet.toLocaleString();
            betUI.classList.add('show');
            stepInfo.innerText = "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô:";
        } else {
            stepInfo.innerText = state.idx > 0 ? "‡∏£‡∏≠‡∏à‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà..." : "‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (6 ‡∏ï‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)";
        }

        document.getElementById('ui-step').innerText = state.idx + 1;
        document.getElementById('ui-pos').innerText = state.pos;
    }
    render();
</script>
</body>
</html>    <div class="stats-bar">
        <div class="mini-stats">
            <span style="color:#777">ALL:<span id="cA" style="color:#fff">0</span></span>
            <span style="color:var(--p-blue)">P:<span id="cP">0</span></span>
            <span style="color:var(--t-green)">T:<span id="cT">0</span></span>
            <span style="color:var(--b-red)">B:<span id="cB">0</span></span>
        </div>
        <button class="btn-history" onclick="toggleHistory()">üìú ‡∏ä‡∏ô‡∏∞: <span id="winCountDisplay">0</span></button>
    </div>

    <div id="plate" class="plate"></div>

    <div class="input-grid">
        <button class="card-btn" style="color:var(--p-blue)" onclick="add('P')">P</button>
        <button class="card-btn" style="color:var(--t-green)" onclick="add('T')">T</button>
        <button class="card-btn" style="color:var(--b-red)" onclick="add('B')">B</button>
    </div>

    <div class="util-grid">
        <button class="btn-util" onclick="undo()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn-util" onclick="reset()">‡∏•‡πâ‡∏≤‡∏á</button>
    </div>
</div>

<div id="settingsPanel" class="modal-overlay">
    <div class="modal-content">
        <b style="color:var(--gold); font-size: 22px;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</b>
        
        <div style="font-size:13px; color:#888; margin: 25px 0 5px; text-align: left;">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div>
        <input type="number" id="profitTargetInput" class="input-text" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç">

        <div style="font-size:13px; color:#888; margin: 10px 0 5px; text-align: left;">‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡πÉ‡∏ä‡πâ - ‡∏Ñ‡∏±‡πà‡∏ô)</div>
        <input type="text" id="moneyPlanInput" class="input-text" placeholder="5-5-10-10">

        <div style="font-size:13px; color:#888; margin: 10px 0 5px; text-align: left;">‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</div>
        <div id="strategyList">
            <div class="strat-item" id="s0" onclick="setStrategy(0)">Standard (2^1)</div>
            <div class="strat-item" id="s1" onclick="setStrategy(1)">‡∏ï‡∏≤‡∏° 2 ‡∏ñ‡∏π‡∏Å (Follow 2 Wins)</div>
            <div class="strat-item active" id="s2" onclick="setStrategy(2)">‡∏ï‡∏≤‡∏° 2 ‡∏ú‡∏¥‡∏î (Follow 2 Loss)</div>
        </div>
        
        <button class="btn-util" style="width:100%; background:var(--p-blue); color:#fff; margin-top:20px; border:none;" onclick="confirmSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
</div>

<div id="historyPanel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 30px;">
        <h2 style="color:var(--gold); margin:0; font-size: 24px;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h2>
        <span onclick="toggleHistory()" style="font-size:40px; cursor:pointer;">‚úï</span>
    </div>
    <div id="historyList"></div>
</div>

<script>
    let logs = [];
    let resultHistory = [];
    let undoStack = [];
    let moneyPlan = [5, 5, 10, 10, 20, 20];
    let profitTarget = 0;
    let currentIndex = 0;
    let recoveryMode = false;
    let currentStrategy = 2;
    let lockedDNA = -1;
    let blockAfterLoss = false;
    let goalReachedAlerted = false; // ‡∏Å‡∏±‡∏ô alert ‡πÄ‡∏î‡πâ‡∏á‡∏ã‡πâ‡∏≥‡πÜ
    const profiles = [['M'], ['T']];

    function saveState() {
        undoStack.push(JSON.stringify({
            logs: [...logs],
            resultHistory: [...resultHistory],
            currentIndex,
            recoveryMode,
            lockedDNA,
            blockAfterLoss,
            goalReachedAlerted
        }));
        if (undoStack.length > 50) undoStack.shift();
    }

    function undo() {
        if (undoStack.length === 0) return;
        let state = JSON.parse(undoStack.pop());
        logs = state.logs;
        resultHistory = state.resultHistory;
        currentIndex = state.currentIndex;
        recoveryMode = state.recoveryMode;
        lockedDNA = state.lockedDNA;
        blockAfterLoss = state.blockAfterLoss;
        goalReachedAlerted = state.goalReachedAlerted;
        render();
    }

    function add(v) {
        saveState();
        if (v !== 'T') {
            if(blockAfterLoss) blockAfterLoss = false;
            if (lockedDNA !== -1) {
                const fullText = document.getElementById('targetTxt').innerText;
                const currentPredict = fullText.slice(-1);
                const isWin = (v === currentPredict);
                
                let betAmount = recoveryMode ? (moneyPlan[currentIndex] + (moneyPlan[currentIndex+1]||0)) : moneyPlan[currentIndex];

                resultHistory.push({
                    round: resultHistory.length + 1,
                    predict: currentPredict,
                    isWin: isWin,
                    amount: betAmount,
                    stepIdx: currentIndex + 1
                });

                if (isWin) {
                    let currentStep = Math.floor(currentIndex / 2);
                    if (currentStep > 0) {
                        recoveryMode = true; 
                        currentIndex = (currentStep - 1) * 2; 
                    } else {
                        currentIndex = 0;
                        recoveryMode = false;
                    }
                } else {
                    currentIndex++;
                    if (currentIndex >= moneyPlan.length) {
                        currentIndex = 0;
                        recoveryMode = false;
                    }
                    lockedDNA = -1;
                    blockAfterLoss = true;
                }
            }
        }
        logs.push(v);
        render();
    }

    function render() {
        const plate = document.getElementById('plate');
        plate.innerHTML = "";
        let p=0, b=0, t=0;
        logs.slice(-72).forEach(v => {
            const d = document.createElement('div'); d.className = `dot ${v}`; d.innerText = v;
            plate.appendChild(d);
            if(v==='P') p++; if(v==='B') b++; if(v==='T') t++;
        });
        for(let i=logs.length; i<72; i++) plate.appendChild(document.createElement('div')).className = 'dot';

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        let currentProfit = resultHistory.reduce((sum, item) => {
            return item.isWin ? sum + item.amount : sum - item.amount;
        }, 0);

        // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
        if (profitTarget > 0 && currentProfit >= profitTarget && !goalReachedAlerted) {
            goalReachedAlerted = true;
            setTimeout(() => alert("‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏£‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß üí∞"), 100);
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πâ‡∏≤
        const targetDisplay = document.getElementById('targetDisplay');
        const profitColor = currentProfit >= 0 ? 'var(--t-green)' : 'var(--b-red)';
        targetDisplay.innerHTML = `‡πÄ‡∏õ‡πâ‡∏≤: <span style="color:${profitColor}">${currentProfit}</span> / ${profitTarget}`;

        document.getElementById('cA').innerText = logs.length;
        document.getElementById('cP').innerText = p;
        document.getElementById('cT').innerText = t;
        document.getElementById('cB').innerText = b;
        document.getElementById('winCountDisplay').innerText = resultHistory.filter(h => h.isWin).length;

        const clean = logs.filter(x => x !== 'T');
        const targetTxt = document.getElementById('targetTxt');
        const betVal = document.getElementById('betVal');
        const targetRect = document.getElementById('target');

        if (lockedDNA === -1 && clean.length >= 4 && !blockAfterLoss) {
            for (let d = 0; d < 2; d++) {
                let res0 = checkPattern(clean, d);
                let res1 = checkPattern(clean.slice(0, -1), d);
                if (currentStrategy === 0 && res0) { lockedDNA = d; break; }
                else if (currentStrategy === 1 && res0 && res1) { lockedDNA = d; break; } 
                else if (currentStrategy === 2 && !res0 && !res1) { lockedDNA = d; break; } 
            }
        }

        if (lockedDNA !== -1 && clean.length > 0) {
            let lastRes = clean[clean.length-1];
            let nextPredict = (profiles[lockedDNA][0] === 'M') ? lastRes : (lastRes === 'P' ? 'B' : 'P');
            targetTxt.innerText = `${currentIndex + 1}${nextPredict}`;
            let amount = recoveryMode ? (moneyPlan[currentIndex] + (moneyPlan[currentIndex+1] || 0)) : moneyPlan[currentIndex];
            betVal.innerText = amount;
            targetRect.className = `target-rect bg-${nextPredict}`;
        } else {
            targetTxt.innerText = "-";
            betVal.innerText = "";
            targetRect.className = "target-rect";
        }
    }

    function checkPattern(cleanData, profileIdx) {
        if (cleanData.length < 2) return false;
        let last = cleanData[cleanData.length - 1];
        let prev = cleanData[cleanData.length - 2];
        let predict = (profiles[profileIdx][0] === 'M') ? prev : (prev === 'P' ? 'B' : 'P');
        return predict === last;
    }

    function setStrategy(id) {
        currentStrategy = id;
        document.querySelectorAll('#strategyList .strat-item').forEach(x => x.classList.remove('active'));
        document.getElementById(`s${id}`).classList.add('active');
        const labels = ["STANDARD 2^1", "FOLLOW 2 WINS", "FOLLOW 2 LOSS"];
        document.getElementById('modeLabel').innerText = labels[id];
        lockedDNA = -1; currentIndex = 0; recoveryMode = false; blockAfterLoss = false; render();
    }

    function toggleSettings() {
        const p = document.getElementById('settingsPanel');
        p.style.display = p.style.display === 'flex' ? 'none' : 'flex';
        document.getElementById('moneyPlanInput').value = moneyPlan.join('-');
        document.getElementById('profitTargetInput').value = profitTarget;
    }

    function confirmSettings() {
        const val = document.getElementById('moneyPlanInput').value;
        const targetVal = document.getElementById('profitTargetInput').value;
        if(val) moneyPlan = val.split('-').map(Number).filter(n => !isNaN(n) && n > 0);
        if(targetVal) {
            profitTarget = parseInt(targetVal) || 0;
            goalReachedAlerted = false; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
        }
        toggleSettings();
        render();
    }

    function toggleHistory() {
        const p = document.getElementById('historyPanel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
        if (p.style.display === 'block') updateHistoryUI();
    }

    function updateHistoryUI() {
        const list = document.getElementById('historyList');
        list.innerHTML = resultHistory.length === 0 ? "<p style='text-align:center;color:#444;margin-top:50px;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>" : "";
        resultHistory.slice().reverse().forEach(item => {
            const div = document.createElement('div');
            div.className = `history-item ${item.isWin ? 'history-win' : 'history-loss'}`;
            div.innerHTML = `
                <div>
                    <span style="color:#666; font-size:11px; display:block; margin-bottom:2px;">ROUND ${item.round}</span>
                    <span style="color:${item.isWin ? 'var(--t-green)' : 'var(--b-red)'}">${item.isWin ? 'WINNER' : 'LOST'} (${item.predict})</span>
                </div>
                <div style="text-align:right;">
                    <div style="font-weight: 800; font-size: 20px;">${item.isWin ? '+' : '-'}${item.amount}</div>
                    <div style="font-size:11px; color:#555;">‡πÑ‡∏°‡πâ ${item.stepIdx}</div>
                </div>
            `;
            list.appendChild(div);
        });
    }

    function reset() {
        if(confirm("üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà?")) {
            logs = []; resultHistory = []; undoStack = []; currentIndex = 0; 
            recoveryMode = false; lockedDNA = -1; blockAfterLoss = false; 
            goalReachedAlerted = false;
            render();
        }
    }

    render();
</script>
</body>
</html>
